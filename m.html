<meta charset="utf-8">
<head>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        #pre, #post {
            font-family: 'Noto Sans KR', sans-serif;
        }
        #preview img {
            max-width: 100%;
        }
    </style>
</head>


<div>
    <textarea id="pre" style="width: 90%; height: 200px;"></textarea>
</div>
<div>
    <!-- <button onclick="load_example1()">예제1</button> -->
    <!-- <button onclick="load_example2()">예제2</button> -->
    <!-- │ -->
    <button onclick="do_coupang()">쿠팡 변환</button>
    <button onclick="do_sabang()">사방넷 변환</button>
    <button onclick="clear_all()">초기화</button>
</div>
<br>
<div>
    <button onclick="remove_enter()">엔터 제거</button>
    <div>
        <textarea id="post" style="width: 50vw; height: 600px; float:left;" oninput="onResultChange()" onkeyup="onResultChange()"></textarea>
    </div>
    <div id="preview" style="width: 40vw; height: 600px; overflow: auto; text-align: center; float:left;">
    </div>
</div>


<script>

function load_example1() {
    document.getElementById('pre').value = example1;
}

function load_example2() {
    document.getElementById('pre').value = example2;
}

function clear_all() {
    console.log('clear');
    document.getElementById('pre').value = "";
    document.getElementById('post').value = "";
    document.getElementById('preview').innerHTML = "";
}

function remove_enter() {
    var post = document.getElementById('post');
    post.value = post.value.replace(/\n/g, '');
    onResultChange();
}

function extract_src(code) {
    var result = [];
    var src = code.match(/src="([^"]*_[0-9]+\.jpg)"/g);

    if (src != null) {
        for (var i = 0; i < src.length; i++) {
            res = src[i].replace('src="', '').replace('"', '');
            result.push(res);
        }
    }

    return result;
}

var mode = '';
function do_sabang() {
    mode = 'sabang';
    var pre = document.getElementById('pre');
    var post = document.getElementById('post');
    var preview_html = "";
    var result = "";

    result = pre.value;
    // | 제거
    result = result.replace(/\|/g, "");
    // <!--- 시작 / 영상 ----> ~ <!--- 종료 ----> 제거
    result = result.replace(/<!--- 시작 \/ 영상 ---->[\s\S]*?<!--- 종료 ---->/g, "");
    // <!--- 시작 / 스냅핏 ----> ~ <!--- 종료 ----> 제거
    result = result.replace(/<!--- 시작 \/ 스냅핏 ---->[\s\S]*?<!--- 종료 ---->/g, "");
    
    imgsrcs = extract_src(result);
    last_text = imgsrcs[imgsrcs.length - 1];
    
    last_imgsrc = result.match(new RegExp(`.*${last_text}.*`, "g"))[0];
    info_imgsrc = last_imgsrc.replace(/_[0-9]+\.jpg/, '_00.jpg');
    result = result.replace(last_imgsrc, last_imgsrc + "\n" + info_imgsrc);
    
    var warning = '<br><br><br><br><div style="text-align: center;">모델 컷은 촬영 장소와 시간, 그래픽 작업의 테크닉에 따라 실제 상품의 컬러와 차이가 있을 수 있습니다.<br>  실제 상품의 컬러는 제품 컷 이미지로 참고하여주세요.<p><img src="http://cdn4-aka.makeshop.co.kr/design/byyj1/images/color_example.jpg" alt="컬러 밝기/명암 조정"></p><p>컬러가 모두 구분되도록 모니터의 밝기/명암 조정을 권장합니다.<br>촬영시 조명이나 빛, 사용하시는 모니터 사양에 따라 색상 차이가 발생할 수 있습니다.<br>제품의 실제 색상과 가장 유사하게 작업하기 위해 최선을 다하고 있습니다.</p></div>';
    result = result + warning;
    
    post.value = result
    onResultChange()
}

function do_coupang() {
    mode = 'coupang';
    var pre = document.getElementById('pre');
    var post = document.getElementById('post');
    var result = "";
    links = [];
    links.push("http://byyjweb.jpg3.kr/partnership/brandbn_cupang.jpg");

    res = extract_src(pre.value);

    if (res.length != 0) {
        last_link = res[res.length - 1];
        last_link = last_link.replace(/_[0-9]+\.jpg/, '_00.jpg');

        res = links.concat(res);
        res.push(last_link);
        res.push("http://byyjweb.jpg3.kr/page/common/copyright_1000.jpg");

        result = res.join(', ');
    }
    
    post.value = result
    onResultChange()
}

function onResultChange() {
    if (mode == 'coupang') {
        var res = document.getElementById('post').value.split(', ');
        var preview_html = "";
        for (var i = 0; i < res.length; i++) {
            preview_html += `<img src="${res[i]}">\n`;
        }
        document.getElementById('preview').innerHTML = preview_html;
    } else {
        document.getElementById('preview').innerHTML = document.getElementById('post').value;
    }
}

document.querySelector('#preview').addEventListener('click', function(e) {
    var clickedElement = e.target;
    console.log(clickedElement.src);
})

</script>
